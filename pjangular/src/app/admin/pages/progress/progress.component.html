<nz-card nzTitle="üìà Qu·∫£n l√Ω Ti·∫øn ƒë·ªô" class="progress-card">
  <form nz-form [formGroup]="progressForm" *ngIf="isAdmin" class="progress-form">
    <div nz-row nzGutter="16">
      <div nz-col nzSpan="8">
        <nz-form-item>
          <nz-form-label nzRequired class="form-label"><i nz-icon nzType="user"></i> Ng∆∞·ªùi d√πng</nz-form-label>
          <nz-form-control [nzErrorTip]="progressForm.get('userId')?.hasError('required') ? 'User is required' : ''">
            <nz-select
              formControlName="userId"
              [(ngModel)]="selectedUserId"
              (ngModelChange)="onUserChange($event)"
              nzPlaceHolder="Ch·ªçn ng∆∞·ªùi d√πng"
              class="custom-select"
            >
              <nz-option *ngFor="let user of users" [nzValue]="user.userId" [nzLabel]="user.username"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col nzSpan="8">
        <nz-form-item>
          <nz-form-label nzRequired class="form-label"><i nz-icon nzType="book"></i> B√†i h·ªçc</nz-form-label>
          <nz-form-control [nzErrorTip]="progressForm.get('lessonId')?.hasError('required') ? 'Lesson is required' : ''">
            <nz-select formControlName="lessonId" nzPlaceHolder="Ch·ªçn b√†i h·ªçc" class="custom-select">
              <nz-option *ngFor="let lesson of lessons" [nzValue]="lesson.lessonId" [nzLabel]="lesson.title"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col nzSpan="8">
        <nz-form-item>
          <nz-form-label nzRequired class="form-label"><i nz-icon nzType="bulb"></i> Lo·∫°i ho·∫°t ƒë·ªông</nz-form-label>
          <nz-form-control [nzErrorTip]="progressForm.get('activityType')?.hasError('required') ? 'Activity type is required' : ''">
            <nz-select formControlName="activityType" nzPlaceHolder="Ch·ªçn lo·∫°i ho·∫°t ƒë·ªông" class="custom-select">
              <nz-option *ngFor="let activityType of activityTypes" [nzValue]="activityType" [nzLabel]="activityType"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col nzSpan="8">
        <nz-form-item>
          <nz-form-label nzRequired class="form-label"><i nz-icon nzType="info-circle"></i> Tr·∫°ng th√°i</nz-form-label>
          <nz-form-control [nzErrorTip]="progressForm.get('status')?.hasError('required') ? 'Status is required' : ''">
            <nz-select formControlName="status" nzPlaceHolder="Ch·ªçn tr·∫°ng th√°i" class="custom-select">
              <nz-option *ngFor="let status of statuses" [nzValue]="status" [nzLabel]="status"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col nzSpan="8">
        <nz-form-item>
          <nz-form-label nzRequired class="form-label"><i nz-icon nzType="percentage"></i> Ho√†n th√†nh (%)</nz-form-label>
          <nz-form-control [nzErrorTip]="
            progressForm.get('completionPercentage')?.hasError('required') ? 'Completion is required' :
            (progressForm.get('completionPercentage')?.hasError('min') || progressForm.get('completionPercentage')?.hasError('max'))
            ? 'T·ª´ 0 ƒë·∫øn 100' : ''
          ">
            <nz-input-number formControlName="completionPercentage" [nzMin]="0" [nzMax]="100" nzPlaceHolder="Nh·∫≠p %" class="custom-input"></nz-input-number>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col nzSpan="8" class="button-col">
        <nz-form-item>
          <nz-form-label>&nbsp;</nz-form-label>
          <nz-form-control>
            <button nz-button nzType="primary" (click)="updateProgress()" class="submit-button">
              <i nz-icon nzType="check-circle"></i> C·∫≠p nh·∫≠t
            </button>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
  </form>

  <nz-divider *ngIf="isAdmin"></nz-divider>

  <nz-table
    #basicTable
    [nzData]="progressList"
    [nzLoading]="!progressList.length"
    nzBordered
    *ngIf="isAdmin"
    class="progress-table"
  >
    <thead>
      <tr>
        <th>Ng∆∞·ªùi d√πng</th>
        <th>B√†i h·ªçc</th>
        <th>Ho·∫°t ƒë·ªông</th>
        <th>Tr·∫°ng th√°i</th>
        <th>Ho√†n th√†nh (%)</th>
        <th>C·∫≠p nh·∫≠t l√∫c</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let progress of basicTable.data">
        <td>{{ getUserUsername(progress.userId) }}</td>
        <td>{{ getLessonTitle(progress.lessonId) }}</td>
        <td>{{ progress.activityType }}</td>
        <td>{{ progress.status }}</td>
        <td>{{ progress.completionPercentage }}</td>
        <td>{{ progress.lastUpdated | date: 'medium' }}</td>
      </tr>
    </tbody>
  </nz-table>

  <div *ngIf="!isAdmin" class="no-permission-message">
    <p><i nz-icon nzType="close-circle"></i> B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p trang qu·∫£n l√Ω ti·∫øn ƒë·ªô.</p>
  </div>
</nz-card>
