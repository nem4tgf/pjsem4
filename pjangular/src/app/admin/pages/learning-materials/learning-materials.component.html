<nz-card nzTitle="üéì Qu·∫£n l√Ω T√†i li·ªáu h·ªçc t·∫≠p" class="materials-card">
  <form nz-form [formGroup]="searchForm" (ngSubmit)="searchMaterials()" class="search-form">
    <div nz-row nzGutter="24">

      <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8" [nzLg]="6">
        <nz-form-item>
          <nz-form-label nzFor="lessonId" class="form-label">
            <i nz-icon nzType="book" class="form-icon"></i> B√†i h·ªçc
          </nz-form-label>
          <nz-form-control>
            <nz-select formControlName="lessonId" nzPlaceHolder="Ch·ªçn b√†i h·ªçc" nzAllowClear nzShowSearch class="custom-select">
              <nz-option *ngFor="let lesson of lessons" [nzValue]="lesson.lessonId" [nzLabel]="lesson.title"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8" [nzLg]="6">
        <nz-form-item>
          <nz-form-label nzFor="materialType" class="form-label">
            <i nz-icon nzType="appstore" class="form-icon"></i> Lo·∫°i t√†i li·ªáu
          </nz-form-label>
          <nz-form-control>
            <nz-select formControlName="materialType" nzPlaceHolder="Ch·ªçn lo·∫°i" nzAllowClear class="custom-select">
              <nz-option nzValue="" nzLabel="T·∫•t c·∫£"></nz-option>
              <nz-option *ngFor="let type of materialTypes" [nzValue]="type" [nzLabel]="type"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8" [nzLg]="6">
        <nz-form-item>
          <nz-form-label nzFor="description" class="form-label">
            <i nz-icon nzType="edit"></i> M√¥ t·∫£
          </nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="description" placeholder="Nh·∫≠p m√¥ t·∫£" class="custom-input"/>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8" [nzLg]="6">
        <nz-form-item>
          <nz-form-label nzFor="transcriptText" class="form-label">
            <i nz-icon nzType="file-word"></i> VƒÉn b·∫£n phi√™n √¢m
          </nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="transcriptText" placeholder="T√¨m ki·∫øm vƒÉn b·∫£n phi√™n √¢m" class="custom-input"/>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="6" class="button-col">
        <nz-form-item>
          <nz-form-label></nz-form-label>
          <nz-form-control>
            <button nz-button nzType="primary" type="submit" class="search-button">
              <i nz-icon nzType="search"></i> T√¨m ki·∫øm
            </button>
            <button nz-button class="reset-button" (click)="searchForm.reset({ page: 0, size: 10, sortBy: 'materialId', sortDir: 'ASC' })">
              <i nz-icon nzType="reload"></i> ƒê·∫∑t l·∫°i
            </button>
          </nz-form-control>
        </nz-form-item>
      </div>

    </div>
  </form>

  <button *ngIf="isAdmin" nz-button nzType="primary" (click)="showModal(false)" class="add-button">
    <i nz-icon nzType="plus"></i> Th√™m t√†i li·ªáu
  </button>

  <nz-table
    #basicTable
    [nzData]="materials"
    [nzLoading]="!materials.length && isAdmin"
    [nzNoResult]="!isAdmin ? 'B·∫°n kh√¥ng c√≥ quy·ªÅn xem t√†i li·ªáu n√†y.' : (materials.length === 0 ? 'Kh√¥ng t√¨m th·∫•y t√†i li·ªáu n√†o.' : '')"
    [nzFrontPagination]="false"
    [nzTotal]="pageData.totalElements"
    [nzPageSize]="pageData.size"
    [nzPageIndex]="pageData.page + 1"
    (nzPageIndexChange)="onPageChange($event)"
    (nzPageSizeChange)="onSizeChange($event)"
    class="materials-table"
  >
    <thead>
      <tr>
        <th [nzSortFn]="true" (nzSortOrderChange)="onSortChange('materialType', $event === 'ascend' ? 'ASC' : 'DESC')" class="table-header">
          <i nz-icon nzType="appstore"></i> Lo·∫°i
        </th>
        <th class="table-header">
          <i nz-icon nzType="link"></i> URL
        </th>
        <th class="table-header">
          <i nz-icon nzType="file-text"></i> M√¥ t·∫£
        </th>
        <th class="table-header">
          <i nz-icon nzType="file-word"></i> VƒÉn b·∫£n phi√™n √¢m
        </th>
        <th class="table-header">
          <i nz-icon nzType="book"></i> B√†i h·ªçc
        </th>
        <th *ngIf="isAdmin" class="table-header">
          <i nz-icon nzType="setting"></i> Thao t√°c
        </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let material of basicTable.data" class="table-row">
        <td class="table-cell">{{ material.materialType }}</td>
        <td class="table-cell">
          <a [href]="material.materialUrl" target="_blank" class="link">{{ material.materialUrl }}</a>
        </td>
        <td class="table-cell">{{ material.description }}</td>
        <td class="table-cell">{{ material.transcriptText }}</td>
        <td class="table-cell">{{ getLessonTitle(material.lessonId) }}</td>
        <td *ngIf="isAdmin" class="table-cell actions-cell">
          <a nz-button nzType="link" (click)="showModal(true, material)" class="action-button">
            <i nz-icon nzType="edit"></i> S·ª≠a
          </a>
          <nz-divider nzType="vertical"></nz-divider>
          <a nz-button nzType="link" nzDanger (click)="material.materialId && deleteMaterial(material.materialId!)" class="action-button">
            <i nz-icon nzType="delete"></i> X√≥a
          </a>
        </td>
      </tr>
    </tbody>
  </nz-table>
</nz-card>

<nz-modal
  [(nzVisible)]="isVisible"
  [nzTitle]="isEdit ? 'Ch·ªânh s·ª≠a T√†i li·ªáu h·ªçc t·∫≠p' : 'Th√™m T√†i li·ªáu h·ªçc t·∫≠p'"
  (nzOnCancel)="handleCancel()"
  (nzOnOk)="handleOk()"
  [nzOkLoading]="false"
  [nzWidth]="600"
>
  <ng-container *nzModalContent>
    <form nz-form [formGroup]="materialForm" nzLayout="vertical">
      <nz-form-item *ngIf="isEdit">
        <nz-form-control>
          <input type="hidden" formControlName="materialId" />
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzRequired nzFor="lessonId">
          <i nz-icon nzType="book"></i> B√†i h·ªçc
        </nz-form-label>
        <nz-form-control [nzErrorTip]="materialForm.get('lessonId')?.invalid && materialForm.get('lessonId')?.touched ? 'Vui l√≤ng ch·ªçn m·ªôt b√†i h·ªçc!' : ''">
          <nz-select formControlName="lessonId" nzPlaceHolder="Ch·ªçn b√†i h·ªçc" nzAllowClear nzShowSearch>
            <nz-option *ngFor="let lesson of lessons" [nzValue]="lesson.lessonId" [nzLabel]="lesson.title"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzRequired nzFor="materialType">
          <i nz-icon nzType="appstore"></i> Lo·∫°i t√†i li·ªáu
        </nz-form-label>
        <nz-form-control [nzErrorTip]="materialForm.get('materialType')?.invalid && materialForm.get('materialType')?.touched ? 'Vui l√≤ng ch·ªçn lo·∫°i t√†i li·ªáu!' : ''">
          <nz-select formControlName="materialType" nzPlaceHolder="Ch·ªçn lo·∫°i">
            <nz-option *ngFor="let type of materialTypes" [nzValue]="type" [nzLabel]="type"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzRequired nzFor="materialUrl">
          <i nz-icon nzType="link"></i> URL t√†i li·ªáu
        </nz-form-label>
        <nz-form-control
          [nzErrorTip]="(materialForm.get('materialUrl')?.invalid && materialForm.get('materialUrl')?.touched) ? (materialForm.get('materialUrl')?.hasError('required') ? 'Vui l√≤ng nh·∫≠p URL t√†i li·ªáu!' : (materialForm.get('materialUrl')?.hasError('pattern') ? 'URL kh√¥ng h·ª£p l·ªá!' : '')) : ''"
        >
          <input nz-input formControlName="materialUrl" placeholder="Nh·∫≠p URL" />
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzFor="description">
          <i nz-icon nzType="file-text"></i> M√¥ t·∫£
        </nz-form-label>
        <nz-form-control>
          <textarea nz-input formControlName="description" placeholder="Nh·∫≠p m√¥ t·∫£" nzAutosize></textarea>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzFor="transcriptText">
          <i nz-icon nzType="file-word"></i> VƒÉn b·∫£n phi√™n √¢m
        </nz-form-label>
        <nz-form-control>
          <textarea nz-input formControlName="transcriptText" placeholder="Nh·∫≠p vƒÉn b·∫£n phi√™n √¢m" nzAutosize></textarea>
        </nz-form-control>
      </nz-form-item>
      </form>
  </ng-container>
</nz-modal>
