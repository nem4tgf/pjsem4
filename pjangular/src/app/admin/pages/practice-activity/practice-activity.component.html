<!-- src/app/admin/pages/practice-activity/practice-activity.component.html -->
<nz-card nzTitle="üìö Qu·∫£n l√Ω Ho·∫°t ƒë·ªông Luy·ªán t·∫≠p" class="practice-activity-card">
  <div *ngIf="isAdmin; else noPermission">
    <!-- Ph·∫ßn t√¨m ki·∫øm v√† b·ªô l·ªçc -->
    <form nz-form [formGroup]="searchForm" (ngSubmit)="applySearchFilters()" class="search-form">
      <div nz-row nzGutter="16">
        <div nz-col nzXs="24" nzSm="12" nzMd="8" nzLg="6">
          <nz-form-item class="search-item">
            <nz-form-label class="form-label">ID B√†i h·ªçc</nz-form-label>
            <nz-form-control>
              <nz-input-number formControlName="lessonId" nzPlaceHolder="ID B√†i h·ªçc" [nzMin]="1"></nz-input-number>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col nzXs="24" nzSm="12" nzMd="8" nzLg="6">
          <nz-form-item class="search-item">
            <nz-form-label class="form-label">Ti√™u ƒë·ªÅ</nz-form-label>
            <nz-form-control>
              <input nz-input formControlName="title" placeholder="Ti√™u ƒë·ªÅ ho·∫°t ƒë·ªông" />
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col nzXs="24" nzSm="12" nzMd="8" nzLg="6">
          <nz-form-item class="search-item">
            <nz-form-label class="form-label">K·ªπ nƒÉng</nz-form-label>
            <nz-form-control>
              <nz-select formControlName="skill" nzPlaceHolder="Ch·ªçn k·ªπ nƒÉng" nzAllowClear>
                <nz-option *ngFor="let skill of getEnumKeys(activitySkills)" [nzValue]="skill" [nzLabel]="skill"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col nzXs="24" nzSm="12" nzMd="8" nzLg="6">
          <nz-form-item class="search-item">
            <nz-form-label class="form-label">Lo·∫°i ho·∫°t ƒë·ªông</nz-form-label>
            <nz-form-control>
              <nz-select formControlName="activityType" nzPlaceHolder="Ch·ªçn lo·∫°i ho·∫°t ƒë·ªông" nzAllowClear>
                <nz-option *ngFor="let type of getEnumKeys(activityTypes)" [nzValue]="type" [nzLabel]="type"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
        <div nz-col nzXs="24" nzSm="24" nzMd="8" nzLg="6" class="button-col">
          <div class="search-buttons">
            <button nz-button nzType="primary" htmlType="submit" [nzLoading]="loading" class="search-button">
              <i nz-icon nzType="search"></i> T√¨m ki·∫øm
            </button>
            <button nz-button (click)="resetSearchFilters()" class="reset-button">
              <i nz-icon nzType="reload"></i> ƒê·∫∑t l·∫°i
            </button>
          </div>
        </div>
      </div>
    </form>

    <nz-divider></nz-divider>

    <!-- N√∫t th√™m m·ªõi -->
    <div class="table-actions">
      <button nz-button nzType="primary" (click)="openCreateModal()" class="add-button">
        <i nz-icon nzType="plus"></i> Th√™m Ho·∫°t ƒë·ªông M·ªõi
      </button>
    </div>

    <!-- B·∫£ng hi·ªÉn th·ªã ho·∫°t ƒë·ªông luy·ªán t·∫≠p -->
    <nz-table
      #basicTable
      [nzData]="activities"
      [nzLoading]="loading"
      [nzNoResult]="'Kh√¥ng t√¨m th·∫•y ho·∫°t ƒë·ªông luy·ªán t·∫≠p n√†o.'"
      [nzTotal]="total"
      [nzPageIndex]="pageIndex"
      [nzPageSize]="pageSize"
      [nzShowPagination]="true"
      [nzShowSizeChanger]="true"
      [nzPageSizeOptions]="[5, 10, 20, 50]"
      (nzPageIndexChange)="onPageIndexChange($event)"
      (nzPageSizeChange)="onPageSizeChange($event)"
      nzBordered
      class="activities-table"
    >
      <thead>
        <tr>
          <th>ID</th>
          <th>ID B√†i h·ªçc</th>
          <th>Ti√™u ƒë·ªÅ</th>
          <th>M√¥ t·∫£</th>
          <th>K·ªπ nƒÉng</th>
          <th>Lo·∫°i</th>
          <th>URL N·ªôi dung</th>
          <th>Ng√†y t·∫°o</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let activity of basicTable.data">
          <td>{{ activity.activityId }}</td>
          <td>{{ activity.lessonId }}</td>
          <td>{{ activity.title }}</td>
          <td>{{ activity.description }}</td>
          <td>{{ activity.activitySkill }}</td>
          <td>{{ activity.activityType }}</td>
          <td>
            <a *ngIf="activity.contentUrl" [href]="activity.contentUrl" target="_blank" class="content-link">
              <i nz-icon nzType="link"></i> Xem n·ªôi dung
            </a>
            <span *ngIf="!activity.contentUrl">N/A</span>
          </td>
          <td>{{ activity.createdAt | date: 'medium' }}</td>
          <td class="actions-cell">
            <a (click)="openEditModal(activity)" nz-tooltip nzTooltipTitle="Ch·ªânh s·ª≠a ho·∫°t ƒë·ªông">
              <i nz-icon nzType="edit"></i> Ch·ªânh s·ª≠a
            </a>
            <nz-divider nzType="vertical"></nz-divider>
            <a nz-popconfirm nzPopconfirmTitle="B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a?" (nzOnConfirm)="deleteActivity(activity.activityId!)" nzOkText="X√≥a" nzCancelText="H·ªßy" nzOkDanger nz-tooltip nzTooltipTitle="X√≥a ho·∫°t ƒë·ªông n√†y">
              <i nz-icon nzType="delete"></i> X√≥a
            </a>
          </td>
        </tr>
      </tbody>
    </nz-table>
  </div>

  <ng-template #noPermission>
    <div class="no-permission-message">
      <i nz-icon nzType="stop" nzTheme="fill"></i> B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p trang qu·∫£n l√Ω ho·∫°t ƒë·ªông luy·ªán t·∫≠p.
    </div>
  </ng-template>

  <!-- Modal th√™m/ch·ªânh s·ª≠a ho·∫°t ƒë·ªông -->
  <nz-modal
    [(nzVisible)]="isModalVisible"
    [nzTitle]="isEditMode ? 'Ch·ªânh s·ª≠a Ho·∫°t ƒë·ªông Luy·ªán t·∫≠p' : 'Th√™m Ho·∫°t ƒë·ªông Luy·ªán t·∫≠p M·ªõi'"
    [nzOkText]="isEditMode ? 'C·∫≠p nh·∫≠t' : 'Th√™m m·ªõi'"
    nzCancelText="H·ªßy"
    (nzOnOk)="handleOk()"
    (nzOnCancel)="handleCancel()"
    [nzMaskClosable]="false"
    [nzClosable]="false"
  >
    <form nz-form [formGroup]="activityForm">
      <nz-form-item>
        <nz-form-label nzRequired nzFor="lessonId">ID B√†i h·ªçc</nz-form-label>
        <nz-form-control nzErrorTip="Vui l√≤ng nh·∫≠p ID b√†i h·ªçc h·ª£p l·ªá (s·ªë nguy√™n d∆∞∆°ng)">
          <nz-input-number id="lessonId" formControlName="lessonId" nzPlaceHolder="Nh·∫≠p ID b√†i h·ªçc" [nzMin]="1"></nz-input-number>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzRequired nzFor="title">Ti√™u ƒë·ªÅ</nz-form-label>
        <nz-form-control nzErrorTip="Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ (t·ªëi ƒëa 255 k√Ω t·ª±)">
          <input nz-input id="title" formControlName="title" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ ho·∫°t ƒë·ªông" />
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzRequired nzFor="description">M√¥ t·∫£</nz-form-label>
        <nz-form-control nzErrorTip="Vui l√≤ng nh·∫≠p m√¥ t·∫£">
          <textarea nz-input id="description" formControlName="description" placeholder="Nh·∫≠p m√¥ t·∫£ ho·∫°t ƒë·ªông" nzAutosize></textarea>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzRequired nzFor="activitySkill">K·ªπ nƒÉng</nz-form-label>
        <nz-form-control nzErrorTip="Vui l√≤ng ch·ªçn k·ªπ nƒÉng">
          <nz-select id="activitySkill" formControlName="activitySkill" nzPlaceHolder="Ch·ªçn k·ªπ nƒÉng">
            <nz-option *ngFor="let skill of getEnumKeys(activitySkills)" [nzValue]="skill" [nzLabel]="skill"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzRequired nzFor="activityType">Lo·∫°i ho·∫°t ƒë·ªông</nz-form-label>
        <nz-form-control nzErrorTip="Vui l√≤ng ch·ªçn lo·∫°i ho·∫°t ƒë·ªông">
          <nz-select id="activityType" formControlName="activityType" nzPlaceHolder="Ch·ªçn lo·∫°i ho·∫°t ƒë·ªông">
            <nz-option *ngFor="let type of getEnumKeys(activityTypes)" [nzValue]="type" [nzLabel]="type"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzFor="contentUrl">URL N·ªôi dung</nz-form-label>
        <nz-form-control>
          <input nz-input id="contentUrl" formControlName="contentUrl" placeholder="Nh·∫≠p URL n·ªôi dung (t√πy ch·ªçn)" />
        </nz-form-control>
      </nz-form-item>
    </form>
  </nz-modal>
</nz-card>
