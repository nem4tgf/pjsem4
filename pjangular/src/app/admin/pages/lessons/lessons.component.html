<nz-card nzTitle="üìö Qu·∫£n l√Ω B√†i h·ªçc" class="lessons-card">
  <form nz-form [formGroup]="searchForm" (ngSubmit)="searchLessons()" class="search-form">
    <div nz-row nzGutter="24">

      <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8" [nzLg]="6">
        <nz-form-item>
          <nz-form-label nzFor="title" class="form-label">
            <i nz-icon nzType="book" class="form-icon"></i> Ti√™u ƒë·ªÅ
          </nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="title" placeholder="T√¨m theo ti√™u ƒë·ªÅ" class="custom-input"/>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8" [nzLg]="6">
        <nz-form-item>
          <nz-form-label nzFor="level" class="form-label">
            <i nz-icon nzType="appstore" class="form-icon"></i> C·∫•p ƒë·ªô
          </nz-form-label>
          <nz-form-control>
            <nz-select formControlName="level" nzPlaceHolder="Ch·ªçn c·∫•p ƒë·ªô" nzAllowClear class="custom-select">
              <nz-option *ngFor="let level of levels" [nzValue]="level" [nzLabel]="level"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8" [nzLg]="6">
        <nz-form-item>
          <nz-form-label nzFor="skill" class="form-label">
            <i nz-icon nzType="bulb"></i> K·ªπ nƒÉng
          </nz-form-label>
          <nz-form-control>
            <nz-select formControlName="skill" nzPlaceHolder="Ch·ªçn k·ªπ nƒÉng" nzAllowClear class="custom-select">
              <nz-option *ngFor="let skill of skills" [nzValue]="skill" [nzLabel]="skill"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8" [nzLg]="6">
        <nz-form-item>
          <nz-form-label nzFor="minPrice" class="form-label">
            <i nz-icon nzType="dollar"></i> Gi√° t·ª´
          </nz-form-label>
          <nz-form-control>
            <nz-input-number formControlName="minPrice" [nzMin]="0" placeholder="Gi√° t·ªëi thi·ªÉu" class="custom-input"></nz-input-number>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="8" [nzLg]="6">
        <nz-form-item>
          <nz-form-label nzFor="maxPrice" class="form-label">
            <i nz-icon nzType="dollar"></i> Gi√° ƒë·∫øn
          </nz-form-label>
          <nz-form-control>
            <nz-input-number formControlName="maxPrice" [nzMin]="0" placeholder="Gi√° t·ªëi ƒëa" class="custom-input"></nz-input-number>
          </nz-form-control>
        </nz-form-item>
      </div>

      <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="24" [nzLg]="6" class="button-col">
        <nz-form-item>
          <nz-form-label></nz-form-label>
          <nz-form-control>
            <button nz-button nzType="primary" type="submit" class="search-button">
              <i nz-icon nzType="search"></i> T√¨m ki·∫øm
            </button>
            <button nz-button class="reset-button" (click)="resetSearch()">
              <i nz-icon nzType="reload"></i> ƒê·∫∑t l·∫°i
            </button>
          </nz-form-control>
        </nz-form-item>
      </div>

    </div>
  </form>

  <nz-divider></nz-divider>

  <button *ngIf="isAdmin" nz-button nzType="primary" (click)="showModal(false)" class="add-button">
    <i nz-icon nzType="plus"></i> Th√™m B√†i h·ªçc
  </button>

  <nz-table
    #basicTable
    [nzData]="lessons"
    [nzLoading]="!lessons.length && searchForm.get('title')?.dirty"
    [nzNoResult]="!isAdmin ? 'B·∫°n kh√¥ng c√≥ quy·ªÅn xem c√°c b√†i h·ªçc.' : 'Kh√¥ng t√¨m th·∫•y b√†i h·ªçc n√†o.'"
    [nzFrontPagination]="false"
    [nzTotal]="pageData.totalElements"
    [nzPageSize]="pageData.size"
    [nzPageIndex]="pageData.page + 1"
    (nzPageIndexChange)="onPageChange($event)"
    (nzPageSizeChange)="onSizeChange($event)"
    class="lessons-table">
    <thead>
      <tr>
        <th class="table-header"
            nzColumnKey="title"
            [nzSortFn]="sortTitleFn"
            [nzSortOrder]="searchForm.get('sortBy')?.value === 'title' ? (searchForm.get('sortDir')?.value === 'ASC' ? 'ascend' : 'descend') : null"
            (nzSortOrderChange)="onSortChange('title', $event)">
          Ti√™u ƒë·ªÅ
        </th>
        <th class="table-header">M√¥ t·∫£</th>
        <th class="table-header"
            nzColumnKey="level"
            [nzSortFn]="sortLevelFn"
            [nzSortOrder]="searchForm.get('sortBy')?.value === 'level' ? (searchForm.get('sortDir')?.value === 'ASC' ? 'ascend' : 'descend') : null"
            (nzSortOrderChange)="onSortChange('level', $event)">
          C·∫•p ƒë·ªô
        </th>
        <th class="table-header"
            nzColumnKey="skill"
            [nzSortFn]="sortSkillFn"
            [nzSortOrder]="searchForm.get('sortBy')?.value === 'skill' ? (searchForm.get('sortDir')?.value === 'ASC' ? 'ascend' : 'descend') : null"
            (nzSortOrderChange)="onSortChange('skill', $event)">
          K·ªπ nƒÉng
        </th>
        <th class="table-header"
            nzColumnKey="price"
            [nzSortFn]="sortPriceFn"
            [nzSortOrder]="searchForm.get('sortBy')?.value === 'price' ? (searchForm.get('sortDir')?.value === 'ASC' ? 'ascend' : 'descend') : null"
            (nzSortOrderChange)="onSortChange('price', $event)">
          Gi√°
        </th>
        <th *ngIf="isAdmin" class="table-header">H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let lesson of basicTable.data" class="table-row">
        <td class="table-cell">{{ lesson.title }}</td>
        <td class="table-cell">{{ lesson.description || 'N/A' }}</td>
        <td class="table-cell">{{ lesson.level }}</td>
        <td class="table-cell">{{ lesson.skill }}</td>
        <td class="table-cell">{{ lesson.price | currency:'VND':'symbol':'1.0-2' }}</td>
        <td *ngIf="isAdmin" class="table-cell actions-cell">
          <a nz-button nzType="link" (click)="showModal(true, lesson)" class="action-button">
            <i nz-icon nzType="edit"></i> S·ª≠a
          </a>
          <nz-divider nzType="vertical"></nz-divider>
          <a nz-popconfirm
             nzPopconfirmTitle="B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ·∫©n b√†i h·ªçc n√†y?"
             nzOkText="C√≥"
             nzCancelText="Kh√¥ng"
             (nzOnConfirm)="softDeleteLesson(lesson.lessonId)"
             nzOkDanger
             nz-button
             nzType="link"
             class="action-button">
            <i nz-icon nzType="eye-invisible"></i> ·∫®n
          </a>
          <nz-divider nzType="vertical"></nz-divider>
          <a nz-button
             nzType="link"
             [routerLink]="['/admin/lesson-vocabulary', lesson.lessonId]" class="action-button">
            <i nz-icon nzType="book"></i> T·ª´ v·ª±ng
          </a>
        </td>
      </tr>
    </tbody>
  </nz-table>

  <div *ngIf="!isAdmin" class="no-permission-message">
    <p><i nz-icon nzType="close-circle"></i> B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p trang qu·∫£n l√Ω b√†i h·ªçc.</p>
  </div>
</nz-card>

<nz-modal
  [(nzVisible)]="isVisible"
  [nzTitle]="isEdit ? 'Ch·ªânh s·ª≠a B√†i h·ªçc' : 'Th√™m B√†i h·ªçc M·ªõi'"
  nzOkText="L∆∞u"
  nzCancelText="H·ªßy"
  (nzOnOk)="handleOk()"
  (nzOnCancel)="handleCancel()"
  [nzOkLoading]="false"
  [nzWidth]="600"
>
  <ng-container *nzModalContent>
    <form nz-form [formGroup]="lessonForm" nzLayout="vertical">
      <nz-form-item *ngIf="isEdit">
        <nz-form-control>
          <input type="hidden" formControlName="lessonId" />
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzRequired nzFor="title">
          <i nz-icon nzType="book"></i> Ti√™u ƒë·ªÅ
        </nz-form-label>
        <nz-form-control [nzErrorTip]="(titleControl?.invalid && (titleControl?.dirty || titleControl?.touched)) ?
                                      (titleControl?.errors?.['required'] ? 'Ti√™u ƒë·ªÅ l√† b·∫Øt bu·ªôc!' :
                                      (titleControl?.errors?.['minlength'] ? 'Ti√™u ƒë·ªÅ ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±!' : '')) : ''">
          <input nz-input formControlName="title" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ b√†i h·ªçc" />
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzFor="description">
          <i nz-icon nzType="file-text"></i> M√¥ t·∫£
        </nz-form-label>
        <nz-form-control>
          <textarea nz-input formControlName="description" placeholder="Nh·∫≠p m√¥ t·∫£ b√†i h·ªçc" nzAutosize></textarea>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzRequired nzFor="level">
          <i nz-icon nzType="appstore"></i> C·∫•p ƒë·ªô
        </nz-form-label>
        <nz-form-control [nzErrorTip]="(levelControl?.invalid && (levelControl?.dirty || levelControl?.touched)) ? 'Vui l√≤ng ch·ªçn c·∫•p ƒë·ªô!' : ''">
          <nz-select formControlName="level" nzPlaceHolder="Ch·ªçn c·∫•p ƒë·ªô">
            <nz-option *ngFor="let level of levels" [nzValue]="level" [nzLabel]="level"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzRequired nzFor="skill">
          <i nz-icon nzType="bulb"></i> K·ªπ nƒÉng
        </nz-form-label>
        <nz-form-control [nzErrorTip]="(skillControl?.invalid && (skillControl?.dirty || skillControl?.touched)) ? 'Vui l√≤ng ch·ªçn k·ªπ nƒÉng!' : ''">
          <nz-select formControlName="skill" nzPlaceHolder="Ch·ªçn k·ªπ nƒÉng">
            <nz-option *ngFor="let skill of skills" [nzValue]="skill" [nzLabel]="skill"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzRequired nzFor="price">
          <i nz-icon nzType="dollar"></i> Gi√°
        </nz-form-label>
        <nz-form-control [nzErrorTip]="
          (priceControl?.invalid && (priceControl?.dirty || priceControl?.touched)) ?
          (priceControl?.errors?.['required'] ? 'Gi√° l√† b·∫Øt bu·ªôc!' :
          (priceControl?.errors?.['min'] ? 'Gi√° ph·∫£i l·ªõn h∆°n 0!' : '')) : ''
        ">
          <nz-input-number formControlName="price" [nzMin]="0.01" nzPlaceHolder="Nh·∫≠p gi√°"></nz-input-number>
        </nz-form-control>
      </nz-form-item>
    </form>
  </ng-container>
</nz-modal>
