<nz-card nzTitle="üì¶ Qu·∫£n l√Ω ƒê∆°n h√†ng" class="orders-card">
  <form nz-form [formGroup]="searchForm" (ngSubmit)="submitSearchForm()" class="search-form">
    <div nz-row nzGutter="16">
      <div nz-col nzSpan="6">
        <nz-form-item>
          <nz-form-label class="form-label"><i nz-icon nzType="user"></i> T√™n ng∆∞·ªùi d√πng</nz-form-label>
          <nz-form-control>
            <input nz-input formControlName="username" placeholder="Nh·∫≠p t√™n ng∆∞·ªùi d√πng" class="custom-input" />
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col nzSpan="6">
        <nz-form-item>
          <nz-form-label class="form-label"><i nz-icon nzType="idcard"></i> ID ng∆∞·ªùi d√πng</nz-form-label>
          <nz-form-control>
            <nz-input-number formControlName="userId" [nzMin]="1" [nzStep]="1" placeholder="Nh·∫≠p ID ng∆∞·ªùi d√πng" class="custom-input"></nz-input-number>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col nzSpan="6">
        <nz-form-item>
          <nz-form-label class="form-label"><i nz-icon nzType="profile"></i> Tr·∫°ng th√°i</nz-form-label>
          <nz-form-control>
            <nz-select formControlName="status" nzPlaceHolder="Ch·ªçn tr·∫°ng th√°i" nzAllowClear class="custom-select">
              <nz-option *ngFor="let status of statusOptions" [nzValue]="status" [nzLabel]="status"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>
      <div nz-col nzSpan="6">
        <nz-form-item>
          <nz-form-label class="form-label"><i nz-icon nzType="calendar"></i> Ng√†y ƒë·∫∑t h√†ng</nz-form-label>
          <nz-form-control>
            <nz-date-picker formControlName="orderDate" nzPlaceHolder="Ch·ªçn ng√†y" class="custom-input"></nz-date-picker>
          </nz-form-control>
        </nz-form-item>
      </div>
    </div>
    <div class="form-actions">
      <button nz-button nzType="primary" [nzLoading]="loading" htmlType="submit" class="search-button">
        <i nz-icon nzType="search"></i> T√¨m ki·∫øm
      </button>
      <button nz-button (click)="resetFilters()" class="reset-button">
        <i nz-icon nzType="reload"></i> ƒê·∫∑t l·∫°i
      </button>
    </div>
  </form>

  <button nz-button nzType="default" (click)="loadOrders()" class="reload-button">
    <i nz-icon nzType="reload"></i> T·∫£i l·∫°i ƒë∆°n h√†ng
  </button>

  <nz-table
    #orderTable
    [nzData]="orders"
    [nzLoading]="loading"
    [nzPageSize]="10"
    [nzShowPagination]="true"
    nzBordered
    class="orders-table"
  >
    <thead>
      <tr>
        <th>ID</th>
        <th>Ng∆∞·ªùi ƒë·∫∑t h√†ng</th>
        <th>Ng√†y ƒë·∫∑t</th>
        <th>T·ªïng ti·ªÅn</th>
        <th>Tr·∫°ng th√°i</th>
        <th>ƒê·ªãa ch·ªâ</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let order of orderTable.data" class="table-row">
        <td>{{ order.orderId }}</td>
        <td>
          <i nz-icon nzType="user" class="form-icon user-icon"></i>
          {{ order.user.fullName }} ({{ order.user.email }})
        </td>
        <td>{{ order.orderDate | date: 'short' }}</td>
        <td>{{ order.totalAmount | currency:'VND':'symbol':'1.0-0' }}</td>
        <td>
          <nz-tag [nzColor]="getStatusTagColor(order.status)">{{ order.status }}</nz-tag>
        </td>
        <td>{{ order.shippingAddress || 'N/A' }}</td>
        <td class="actions-cell">
          <a (click)="showOrderDetailModal(order)"><i nz-icon nzType="eye"></i> Xem</a>
          <nz-divider nzType="vertical"></nz-divider>
          <a (click)="showUpdateStatusModal(order)"><i nz-icon nzType="edit"></i> S·ª≠a</a>
          <nz-divider nzType="vertical"></nz-divider>
          <a nz-popconfirm nzPopconfirmTitle="B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√¥ng?" (nzOnConfirm)="deleteOrder(order.orderId)" nzOkText="X√≥a" nzCancelText="H·ªßy" nzOkDanger>
            <i nz-icon nzType="delete"></i> X√≥a
          </a>
        </td>
      </tr>
    </tbody>
  </nz-table>
</nz-card>

<nz-modal
  [(nzVisible)]="isVisible"
  nzTitle="üßæ Chi ti·∫øt ƒë∆°n h√†ng #{{ selectedOrder?.orderId }}"
  [nzFooter]="null"
  (nzOnCancel)="handleCancel()"
  [nzWidth]="800"
  class="modal"
>
  <ng-template *nzModalContent>
    <div *ngIf="selectedOrder">
      <p><i nz-icon nzType="user"></i> <b>Ng∆∞·ªùi ƒë·∫∑t:</b> {{ selectedOrder.user.fullName }} ({{ selectedOrder.user.email }})</p>
      <p><i nz-icon nzType="calendar"></i> <b>Ng√†y ƒë·∫∑t:</b> {{ selectedOrder.orderDate | date: 'medium' }}</p>
      <p><i nz-icon nzType="dollar"></i> <b>T·ªïng ti·ªÅn:</b> {{ selectedOrder.totalAmount | currency:'VND':'symbol':'1.0-0' }}</p>
      <p><i nz-icon nzType="info-circle"></i> <b>Tr·∫°ng th√°i:</b> <nz-tag [nzColor]="getStatusTagColor(selectedOrder.status)">{{ selectedOrder.status }}</nz-tag></p>
      <p><i nz-icon nzType="home"></i> <b>ƒê·ªãa ch·ªâ:</b> {{ selectedOrder.shippingAddress || 'Ch∆∞a cung c·∫•p' }}</p>

      <nz-divider nzText="üìö S·∫£n ph·∫©m trong ƒë∆°n h√†ng"></nz-divider>

      <nz-table [nzData]="selectedOrder.items" nzSize="small" [nzShowPagination]="false" nzBordered>
        <thead>
          <tr>
            <th>ID</th>
            <th>ID B√†i h·ªçc</th>
            <th>Ti√™u ƒë·ªÅ</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>Gi√° t·∫°i th·ªùi ƒëi·ªÉm</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of selectedOrder.items">
            <td>{{ item.orderDetailId }}</td>
            <td>{{ item.lesson.lessonId }}</td>
            <td>{{ item.lesson.title }}</td>
            <td>{{ item.quantity }}</td>
            <td>{{ item.priceAtPurchase | currency:'VND':'symbol':'1.0-0' }}</td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </ng-template>
</nz-modal>
