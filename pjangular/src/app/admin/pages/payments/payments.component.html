<nz-card nzTitle="üí≥ Qu·∫£n l√Ω Thanh to√°n" class="payments-card">
  <div class="table-operations">
    <button nz-button nzType="primary" (click)="loadPayments()" class="reload-button">
      <i nz-icon nzType="reload" class="icon-reload"></i> T·∫£i l·∫°i
    </button>
  </div>

  <nz-table
    #paymentTable
    [nzData]="payments"
    [nzLoading]="loading"
    nzShowPagination
    [nzPageSize]="10"
    nzBordered
    class="payments-table"
  >
    <thead>
      <tr>
        <th><i nz-icon nzType="credit-card" class="icon-dollar"></i> ID Giao d·ªãch</th>
        <th><i nz-icon nzType="user" class="icon-user"></i> Ng∆∞·ªùi d√πng</th>
        <th><i nz-icon nzType="file-done" class="icon-idcard"></i> ID ƒê∆°n h√†ng</th>
        <th><i nz-icon nzType="dollar" class="icon-dollar"></i> S·ªë ti·ªÅn</th>
        <th><i nz-icon nzType="calendar" class="icon-calendar"></i> Ng√†y thanh to√°n</th>
        <th><i nz-icon nzType="bank" class="icon-home"></i> Ph∆∞∆°ng th·ª©c</th>
        <th><i nz-icon nzType="key" class="icon-profile"></i> Transaction ID</th>
        <th><i nz-icon nzType="info-circle" class="icon-info"></i> Tr·∫°ng th√°i</th>
        <th><i nz-icon nzType="file-text" class="icon-book"></i> M√¥ t·∫£</th>
        <th><i nz-icon nzType="tool" class="icon-edit"></i> H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let payment of paymentTable.data" class="table-row">
        <td>{{ payment.paymentId }}</td>
        <td>{{ payment.user?.fullName }} ({{ payment.user?.email }})</td>
        <td>{{ payment.orderId }}</td>
        <td>{{ payment.amount | currency:'VND':'symbol':'1.0-0' }}</td>
        <td>{{ payment.paymentDate | date: 'short' }}</td>
        <td>{{ payment.paymentMethod }}</td>
        <td>{{ payment.transactionId }}</td>
        <td>
          <nz-tag [nzColor]="getPaymentStatusTagColor(payment.status)">
            {{ payment.status }}
          </nz-tag>
        </td>
        <td>{{ payment.description || 'N/A' }}</td>
        <td class="actions-cell">
          <a (click)="showPaymentDetailModal(payment)">
            <i nz-icon nzType="eye" class="icon-eye"></i> Xem chi ti·∫øt
          </a>
          <nz-divider nzType="vertical"></nz-divider>
          <a
            nz-popconfirm
            nzPopconfirmTitle="B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√¥ng?"
            (nzOnConfirm)="deletePayment(payment.paymentId)"
            nzPopconfirmPlacement="left"
            nzOkText="X√≥a"
            nzCancelText="H·ªßy"
            nzOkDanger
          >
            <i nz-icon nzType="delete" class="icon-delete"></i> X√≥a
          </a>
        </td>
      </tr>
    </tbody>
  </nz-table>
</nz-card>

<nz-modal
  [(nzVisible)]="isVisible"
  nzTitle="üßæ Chi ti·∫øt Thanh to√°n #{{ selectedPayment?.paymentId }}"
  [nzFooter]="null"
  (nzOnCancel)="handleCancel()"
  (nzOnOk)="handleOk()"
  [nzWidth]="800"
  class="modal"
>
  <div *nzModalContent>
    <div *ngIf="selectedPayment">
      <p><i nz-icon nzType="credit-card" class="icon-dollar"></i> <b>ID Giao d·ªãch:</b> {{ selectedPayment.paymentId }}</p>
      <p><i nz-icon nzType="user" class="icon-user"></i> <b>Ng∆∞·ªùi d√πng:</b> {{ selectedPayment.user?.fullName }} ({{ selectedPayment.user?.email }})</p>
      <p><i nz-icon nzType="file-done" class="icon-idcard"></i> <b>ID ƒê∆°n h√†ng:</b> {{ selectedPayment.orderId }}</p>
      <p><i nz-icon nzType="dollar" class="icon-dollar"></i> <b>S·ªë ti·ªÅn:</b> {{ selectedPayment.amount | currency:'VND':'symbol':'1.0-0' }}</p>
      <p><i nz-icon nzType="calendar" class="icon-calendar"></i> <b>Ng√†y thanh to√°n:</b> {{ selectedPayment.paymentDate | date: 'medium' }}</p>
      <p><i nz-icon nzType="bank" class="icon-home"></i> <b>Ph∆∞∆°ng th·ª©c:</b> {{ selectedPayment.paymentMethod }}</p>
      <p><i nz-icon nzType="key" class="icon-profile"></i> <b>Transaction ID:</b> {{ selectedPayment.transactionId }}</p>
      <p><i nz-icon nzType="info-circle" class="icon-info"></i> <b>Tr·∫°ng th√°i:</b>
        <nz-tag [nzColor]="getPaymentStatusTagColor(selectedPayment.status)">
          {{ selectedPayment.status }}
        </nz-tag>
      </p>
      <p><i nz-icon nzType="file-text" class="icon-book"></i> <b>M√¥ t·∫£:</b> {{ selectedPayment.description || 'Ch∆∞a c√≥' }}</p>
    </div>
  </div>
</nz-modal>
